<!-- HTML header for doxygen 1.9.3-->
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <meta name="generator" content="Doxygen 1.13.2" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="favicon.png" sizes="16x16" type="image/png">
    <title>ZotBins Core: Software Architecture</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript">
        DoxygenAwesomeDarkModeToggle.init()
    </script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
        <div id="top">
            <!-- do not remove this div, it is closed by doxygen! -->
            <div id="titlearea">
                <table cellspacing="0" cellpadding="0">
                    <tbody>
                        <tr id="projectrow">
                            <td id="projectalign">
                                <div id="projectname">ZotBins Core
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__2github_2workspace_2docs_2sw__architecture.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Software Architecture</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md8"></a></p>
<h1><a class="anchor" id="autotoc_md9"></a>
Introduction</h1>
<p>The purpose of this document is to provide a detailed overview of the software architecture behind the new ZotBins Core, focusing on reliability, maintainability, and efficiency.</p>
<p>The intention of this document is to help the embedded system development team understand how the system is structured.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Background</h1>
<p>ZotBins Core is a IoT Smart Bin to keep track of waste data metrics like bin fullness, weight, usage rates, etc. This is intended to help quantify waste data and promote solutions to reduce the amount of waste people throw away.</p>
<p>The previous iteration was a Raspberry Pi-based system. This system is intended to a replacement for the Raspberry Pi system, while being more reliable, maintainable, efficient, and testable.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Functional Requirements</h1>
<p>Many of the features revolve around the various sensors that the ZotBins Core utilize.</p>
<ul>
<li>Breakbeam Sensor: Measure the amount of time a bin is used in a 30 minute time period</li>
<li>Load Cell &amp; HX-711: Measure the weight of the trash currently in the bin</li>
<li>Ultrasonic sensor: Measure the current fullness of the trash can</li>
</ul>
<p>Additionally, the system must publish the sensor data to a MQTT broker every 30 minutes.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Architecture Overview</h1>
<p>ZotBins Core is a RTOS application, where each function is divided into a separate task to optimize the efficiency and relability of the system. Each sensor has its own task and in the off chance the sensor fails, the overall system can still function as intended.</p>
<p>Each sensor task will pass its sensor data to the MQTT task through a thread-safe queue, so the MQTT Task can publish its sensor data to the MQTT broker.</p>
<p>This system of having a task for each sensor makes the system more maintainable due to separation of concerns. The fullness task does not need to worry about the state of the weight task and can just focus on itself. In addition, the system is more extensible since a new task can be easily added to the system without interfering with the other features.</p>
<h3><a class="anchor" id="autotoc_md13"></a>
Overall System Diagram (more detail on each task is shown down below)</h3>
<div class="plantumlgraph">
<img src="inline_umlgraph_1.png" />
</div>
<h2><a class="anchor" id="autotoc_md14"></a>
Fullness Task</h2>
<p>The Fullness Task is responsible for measuring the current fullness of the waste bin. This is measured by the following equation. The height of the waste bin should be hard coded for each ZotBins Core deployment as each bin might differ in height.</p>
<div class="fragment"><div class="line">Fullness % = (Height of Bin - Distance measured from ultrasonic sensor) / Height of Bin</div>
</div><!-- fragment --><p>If the ultrasonic sensor reads an invalid value, it should log the error and return a error value like <code>-1</code> so the MQTT thread is not blocked waiting for the fullness value.</p>
<div class="plantumlgraph">
<img src="inline_umlgraph_2.png" />
</div>
<h2><a class="anchor" id="autotoc_md15"></a>
Weight Task</h2>
<p>The Weight Task is responsible for measuring the current weight in kilograms of the waste bin. This is measured using load cells and the HX711 load cell amplifier for the MCU to read.</p>
<p>If an invalid weight is read from the HX711, or if the weight sensor is not performing as expected, we will log the error and send a corresponding error value to the queue, so the MQTT thread is not blocked waiting for the weight value.</p>
<div class="plantumlgraph">
<img src="inline_umlgraph_3.png" />
</div>
<h2><a class="anchor" id="autotoc_md16"></a>
Usage Task</h2>
<p>TODO</p>
<h2><a class="anchor" id="autotoc_md17"></a>
MQTT Task</h2>
<p>TODO </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
